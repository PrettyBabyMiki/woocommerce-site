version: ~> 1.0

cache:
    directories:
        - vendor
        - node_modules
        - $HOME/.npm
        - $HOME/.composer/cache

before_install:
    - timedatectl
    - nvm install --latest-npm

jobs:
  fast_finish: true
  include:
    - name: "Core E2E Tests"
    php: 7.4
    env: WP_VERSION=latest WP_MULTISITE=0
    script:
        - bash bin/before-script-CI.sh
        - composer require wp-cli/i18n-command
        - npm run build
        - npm explore @woocommerce/e2e-env -- npm run docker:up
        - npm explore @woocommerce/e2e-env -- npm run test:e2e
    after_script:
        - npm explore @woocommerce/e2e-env -- npm run docker:down
