jQuery(function(e){function t(){var t=e("select#product-type").val();var n=e("input#_virtual:checked").size();var r=e("input#_downloadable:checked").size();var i=".hide_if_downloadable, .hide_if_virtual";var s=".show_if_downloadable, .show_if_virtual, .show_if_external";e.each(woocommerce_admin_meta_boxes.product_types,function(e,t){i=i+", .hide_if_"+t;s=s+", .show_if_"+t});e(i).show();e(s).hide();if(r){e(".show_if_downloadable").show()}if(n){e(".show_if_virtual").show()}e(".show_if_"+t).show();if(r){e(".hide_if_downloadable").hide()}if(n){e(".hide_if_virtual").hide()}e(".hide_if_"+t).hide();e("input#_manage_stock").change()}function i(){e(".product_attributes .woocommerce_attribute").each(function(t,n){e(".attribute_position",n).val(parseInt(e(n).index(".product_attributes .woocommerce_attribute")))})}e(function(){e('[id$="-all"] > ul.categorychecklist').each(function(){var t=e(this);var n=t.find(":checked").first();if(!n.length)return;var r=t.find("input").position().top;var i=n.position().top;t.closest(".tabs-panel").scrollTop(i-r+5)})});e("#upsell_product_data").bind("keypress",function(e){if(e.keyCode==13)return false});e(".type_box").appendTo("#woocommerce-product-data h3.hndle span");e(function(){e("#woocommerce-product-data h3.hndle").unbind("click.postboxes");jQuery("#woocommerce-product-data").on("click","h3.hndle",function(t){if(e(t.target).filter("input, option, label, select").length)return;e("#woocommerce-product-data").toggleClass("closed")})});e("#catalog-visibility .edit-catalog-visibility").click(function(){if(e("#catalog-visibility-select").is(":hidden")){e("#catalog-visibility-select").slideDown("fast");e(this).hide()}return false});e("#catalog-visibility .save-post-visibility").click(function(){e("#catalog-visibility-select").slideUp("fast");e("#catalog-visibility .edit-catalog-visibility").show();var t=e("input[name=_visibility]:checked").val();var n=e("input[name=_visibility]:checked").attr("data-label");if(e("input[name=_featured]").is(":checked")){n=n+", "+woocommerce_admin_meta_boxes.featured_label;e("input[name=_featured]").attr("checked","checked")}e("#catalog-visibility-display").text(n);return false});e("#catalog-visibility .cancel-post-visibility").click(function(){e("#catalog-visibility-select").slideUp("fast");e("#catalog-visibility .edit-catalog-visibility").show();var t=e("#current_visibility").val();var n=e("#current_featured").val();e("input[name=_visibility]").removeAttr("checked");e("input[name=_visibility][value="+t+"]").attr("checked","checked");var r=e("input[name=_visibility]:checked").attr("data-label");if(n=="yes"){r=r+", "+woocommerce_admin_meta_boxes.featured_label;e("input[name=_featured]").attr("checked","checked")}else{e("input[name=_featured]").removeAttr("checked")}e("#catalog-visibility-display").text(r);return false});e("select#product-type").change(function(){var n=e(this).val();if("variable"===n){e("input#_manage_stock").change();e("input#_downloadable").prop("checked",false);e("input#_virtual").removeAttr("checked")}else if("grouped"===n){e("input#_downloadable").prop("checked",false);e("input#_virtual").removeAttr("checked")}else if("external"===n){e("input#_downloadable").prop("checked",false);e("input#_virtual").removeAttr("checked")}t();e("ul.wc-tabs li:visible").eq(0).find("a").click();e("body").trigger("woocommerce-product-type-change",n,e(this))}).change();e("body").on("woocommerce-product-type-change",function(t,n){if("variable"!==n&&0<e("#variable_product_options input[name^=variable_sku]").length&&e("body").triggerHandler("woocommerce-display-product-type-alert",n)!==false){window.alert(woocommerce_admin_meta_boxes.i18n_product_type_alert)}});e("input#_downloadable, input#_virtual").change(function(){t()});e(".sale_price_dates_fields").each(function(){var t=e(this);var n=false;var r=t.closest("div, table");t.find("input").each(function(){if(e(this).val()!="")n=true});if(n){r.find(".sale_schedule").hide();r.find(".sale_price_dates_fields").show()}else{r.find(".sale_schedule").show();r.find(".sale_price_dates_fields").hide()}});e("#woocommerce-product-data").on("click",".sale_schedule",function(){var t=e(this).closest("div, table");e(this).hide();t.find(".cancel_sale_schedule").show();t.find(".sale_price_dates_fields").show();return false});e("#woocommerce-product-data").on("click",".cancel_sale_schedule",function(){var t=e(this).closest("div, table");e(this).hide();t.find(".sale_schedule").show();t.find(".sale_price_dates_fields").hide();t.find(".sale_price_dates_fields").find("input").val("");return false});e("#woocommerce-product-data").on("click",".downloadable_files a.insert",function(){e(this).closest(".downloadable_files").find("tbody").append(e(this).data("row"));return false});e("#woocommerce-product-data").on("click",".downloadable_files a.delete",function(){e(this).closest("tr").remove();return false});e("input#_manage_stock").change(function(){if(e(this).is(":checked")){e("div.stock_fields").show()}else{e("div.stock_fields").hide()}}).change();var n=e(".sale_price_dates_fields input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:true,showOn:"button",buttonImage:woocommerce_admin_meta_boxes.calendar_image,buttonImageOnly:true,onSelect:function(t){var r=e(this).is("#_sale_price_dates_from, .sale_price_dates_from")?"minDate":"maxDate";var i=e(this).data("datepicker"),s=e.datepicker.parseDate(i.settings.dateFormat||e.datepicker._defaults.dateFormat,t,i.settings);n.not(this).datepicker("option",r,s)}});var r=e(".product_attributes").find(".woocommerce_attribute").get();r.sort(function(t,n){var r=parseInt(e(t).attr("rel"));var i=parseInt(e(n).attr("rel"));return r<i?-1:r>i?1:0});e(r).each(function(t,n){e(".product_attributes").append(n)});e(".product_attributes .woocommerce_attribute").each(function(t,n){if(e(n).css("display")!="none"&&e(n).is(".taxonomy")){e("select.attribute_taxonomy").find('option[value="'+e(n).data("taxonomy")+'"]').attr("disabled","disabled")}});e("button.add_attribute").on("click",function(){var t=e(".product_attributes .woocommerce_attribute").size();var n=e("select.attribute_taxonomy").val();var r=e(this).closest("#product_attributes").find(".product_attributes");var s=e("select#product-type").val();var o={action:"woocommerce_add_attribute",taxonomy:n,i:t,security:woocommerce_admin_meta_boxes.add_attribute_nonce};r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(t){r.append(t);if(s!=="variable"){r.find(".enable_variation").hide()}e("body").trigger("wc-enhanced-select-init");i();r.unblock();e("body").trigger("woocommerce_added_attribute")});if(n){e("select.attribute_taxonomy").find('option[value="'+n+'"]').attr("disabled","disabled");e("select.attribute_taxonomy").val("")}return false});e(".product_attributes").on("blur","input.attribute_name",function(){e(this).closest(".woocommerce_attribute").find("strong.attribute_name").text(e(this).val())});e(".product_attributes").on("click","button.select_all_attributes",function(){e(this).closest("td").find("select option").attr("selected","selected");e(this).closest("td").find("select").change();return false});e(".product_attributes").on("click","button.select_no_attributes",function(){e(this).closest("td").find("select option").removeAttr("selected");e(this).closest("td").find("select").change();return false});e(".product_attributes").on("click","button.remove_row",function(){var t=confirm(woocommerce_admin_meta_boxes.remove_attribute);if(t){var n=e(this).parent().parent();if(n.is(".taxonomy")){n.find("select, input[type=text]").val("");n.hide();e("select.attribute_taxonomy").find('option[value="'+n.data("taxonomy")+'"]').removeAttr("disabled")}else{n.find("select, input[type=text]").val("");n.hide();i()}}return false});e(".product_attributes").sortable({items:".woocommerce_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:true,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style");i()}});e(".product_attributes").on("click","button.add_new_attribute",function(){e(".product_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=e(this).closest(".woocommerce_attribute");var n=t.data("taxonomy");var r=prompt(woocommerce_admin_meta_boxes.new_attribute_prompt);if(r){var i={action:"woocommerce_add_new_attribute",taxonomy:n,term:r,security:woocommerce_admin_meta_boxes.add_attribute_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,i,function(n){if(n.error){alert(n.error)}else if(n.slug){t.find("select.attribute_values").append('<option value="'+n.slug+'" selected="selected">'+n.name+"</option>");t.find("select.attribute_values").change()}e(".product_attributes").unblock()})}else{e(".product_attributes").unblock()}return false});e(".save_attributes").on("click",function(){e(".product_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t={post_id:woocommerce_admin_meta_boxes.post_id,data:e(".product_attributes").find("input, select, textarea").serialize(),action:"woocommerce_save_attributes",security:woocommerce_admin_meta_boxes.save_attributes_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){var n=window.location.toString();n=n.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&");e("#variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e("#variable_product_options").load(n+" #variable_product_options_inner",function(){e("#variable_product_options").unblock()});e(".product_attributes").unblock()})});var s;var o;jQuery(document).on("click",".upload_file_button",function(t){var n=e(this);o=n.closest("tr").find("td.file_url input");t.preventDefault();if(s){s.open();return}var r=[new wp.media.controller.Library({library:wp.media.query(),multiple:true,title:n.data("choose"),priority:20,filterable:"uploaded"})];s=wp.media.frames.downloadable_file=wp.media({title:n.data("choose"),library:{type:""},button:{text:n.data("update")},multiple:true,states:r});s.on("select",function(){var e="";var t=s.state().get("selection");t.map(function(t){t=t.toJSON();if(t.url)e=t.url});o.val(e)});s.on("ready",function(){s.uploader.options.uploader.params={type:"downloadable_product"}});s.open()});jQuery(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:true,helper:"clone",opacity:.65});var u;var a=e("#product_image_gallery");var f=e("#product_images_container ul.product_images");jQuery(".add_product_images").on("click","a",function(t){var n=e(this);var r=a.val();t.preventDefault();if(u){u.open();return}u=wp.media.frames.product_gallery=wp.media({title:n.data("choose"),button:{text:n.data("update")},states:[new wp.media.controller.Library({title:n.data("choose"),filterable:"all",multiple:true})]});u.on("select",function(){var e=u.state().get("selection");e.map(function(e){e=e.toJSON();if(e.id){r=r?r+","+e.id:e.id;f.append('					<li class="image" data-attachment_id="'+e.id+'">						<img src="'+e.sizes.thumbnail.url+'" />						<ul class="actions">							<li><a href="#" class="delete" title="'+n.data("delete")+'">'+n.data("text")+"</a></li>						</ul>					</li>")}});a.val(r)});u.open()});f.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:true,forceHelperSize:false,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(t,n){var r="";e("#product_images_container ul li.image").css("cursor","default").each(function(){var e=jQuery(this).attr("data-attachment_id");r=r+e+","});a.val(r)}});e("#product_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";e("#product_images_container ul li.image").css("cursor","default").each(function(){var e=jQuery(this).attr("data-attachment_id");t=t+e+","});a.val(t);e("#tiptip_holder").removeAttr("style");e("#tiptip_arrow").removeAttr("style");return false})})